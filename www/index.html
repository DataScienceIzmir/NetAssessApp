<!DOCTYPE html>
<html lang="en" class="no-js">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
		<title>NetAssess</title>
		<meta name="description" content="A web application for assessing the US continuous air pollutant monitoring network" />
		<meta name="keywords" content="" />
		<meta name="author" content="Eric Bailey et al" />
		<link rel="stylesheet" type="text/css" href="css/netassess.css" />
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/toggle.css" rel="stylesheet" type = "text/css" />
	</head>
	
	<body>

		<div id = "map"></div>
	
		<div id = "sidebar" class = "na-sidebar na-closed">
			<div class = "na-inner-sidebar">
				<div class = "na-sidebar-group">
					<div class = "na-sidebar-group-heading">
						<a><i class = "fa fa-fw fa-rocket"></i> Area Served</a>
					</div>
					<div class = "na-sidebar-group-content na-sidebar-group-open">
						<p>This is where content will go.</p>
						<select>
              <option value='POP2010'>2010 Population</option>
              <option value='POP10_SQMI'>2010 Population Density</option>
              <option value='POP2012'>2012 Population</option>
              <option value='POP12_SQMI'>2012 Population Density</option>
              <option value='WHITE'>White Population</option>
              <option value='BLACK'>Black Population</option>
              <option value='AMERI_ES'>American Eskimo Population</option>
              <option value='ASIAN'>Asian Population</option>
              <option value='HAWN_PI'>Hawaiian/Pacific Islander Population</option>
              <option value='HISPANIC'>Hispanic Population</option>
              <option value='OTHER'>"Other" Population</option>
              <option value='MULT_RACE'>Multi-Race Population</option>
              <option value='MALES'>Male Population</option>
              <option value='FEMALES'>Female Population</option>
              <option value='AGE_UNDER5'>Population Under Age 5</option>
              <option value='AGE_5_9'>Population Age 5 to 9</option>
              <option value='AGE_10_14'>Population Age 10 to 14</option>
              <option value='AGE_15_19'>Population Age 15 to 19</option>
              <option value='AGE_20_24'>Population Age 20 to 24</option>
              <option value='AGE_25_34'>Population Age 25 to 34</option>
              <option value='AGE_35_44'>Population Age 35 to 44</option>
              <option value='AGE_45_54'>Population Age 45 to 54</option>
              <option value='AGE_55_64'>Population Age 55 to 64</option>
              <option value='AGE_65_74'>Population Age 65 to 74</option>
              <option value='AGE_75_84'>Population Age 75 to 84</option>
              <option value='AGE_85_UP'>Population Age 85 and Above</option>
              <option value='MED_AGE'>Median Age</option>
              <option value='MED_AGE_M'>Median Age - Males</option>
              <option value='MED_AGE_F'>Median Age - Females</option>
              <option value='HOUSEHOLDS'>Number of Households</option>
              <option value='AVE_HH_SZ'>Average Household Size</option>
              <option value='HSEHLD_1_M'>Single Male Households</option>
              <option value='HSEHLD_1_F'>Single Female Households</option>
              <option value='MARHH_CHD'>Married Households with Children</option>
              <option value='MARHH_NO_C'>Married Households without Children</option>
              <option value='MHH_CHILD'>Male Household with Children</option>
              <option value='FHH_CHILD'>Female Household without Children</option>
              <option value='FAMILIES'>Number of Families</option>
              <option value='AVE_FAM_SZ'>Average Family Size</option>
              <option value='HSE_UNITS'>Housing Units</option>
              <option value='VACANT'>Vacant Housing</option>
              <option value='OWNER_OCC'>Owner-Occupied Housing</option>
              <option value='RENTER_OCC'>Renter-Occupied Housing</option>
              <option value='SQMI'>Square Miles</option>
						</select>
					</div>
				</div>
				<div class = "na-sidebar-group">
					<div class = "na-sidebar-group-heading">
						<a><i class = "fa fa-fw fa-paw"></i> Correlation Matrix</a>
					</div>
					<div class = "na-sidebar-group-content na-sidebar-group-closed">
						<p>This is where content will go.</p>
						<select>
							<option>POP2010</option>
							<option>POP2012</option>
						</select>
					</div>
				</div>
				<div class = "na-sidebar-group">
					<div class = "na-sidebar-group-heading">
						<a><i class = "fa fa-fw fa-birthday-cake"></i> New Sites</a>
					</div>
					<div class = "na-sidebar-group-content na-sidebar-group-closed">
						<p>This is where content will go.</p>
						<select>
							<option>POP2010</option>
							<option>POP2012</option>
						</select>
					</div>
				</div>
				<div class = "na-sidebar-group">
					<div class = "na-sidebar-group-heading">
						<a><i class = "fa fa-fw fa-futbol-o"></i> Remove Bias</a>
					</div>
					<div class = "na-sidebar-group-content na-sidebar-group-closed">
						<p>This is where content will go.</p>
						<select>
							<option>POP2010</option>
							<option>POP2012</option>
						</select>
					</div>
				</div>

			</div>
		</div>
  
    <header>
    
      <div class = "na-trigger">
        <a><i class = "fa fa-fw fa-bars"></i></a>
      </div>
      <span class = "na-main-title">NetAssess</span>
			<span class = "na-sub-title">Ambient Air Monitoring Network Assessment Tool</span>
      <span class = "right-items">
        <span class = "na-button-group">
          <span class = "na-button na-active">2011</span><span class = "na-button na-active">2012</span><span class = "na-button na-active">2013</span>
        </span>
        <span>
          <div class="onoffswitch">
            <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked>
            <label class="onoffswitch-label" for="myonoffswitch">
              <span class="onoffswitch-inner"></span>
              <span class="onoffswitch-switch"></span>
            </label>
          </div> 
        </span>
        <span class = "na-button" id = "na-zoom-out"><i class = "fa fa-fw fa-search-minus"></i></span>
        <span>
          <span class = "na-button" id = "na-zoom-in"><i class = "fa fa-search-plus fa-fw"></i></span><input type = "text" class = "na-header-element na-search" id = "na-search-input" value = "" placeholder = "Zoom to Feature"></input>
        </span>
      </span>
      
    </header>
  
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://cdn-geoweb.s3.amazonaws.com/esri-leaflet/0.0.1-beta.5/esri-leaflet.js"></script>
    <script src="scripts/statebounds.js"></script>
		<script>

      $(".na-button-group .na-button").on("click", function(e) {
        $(this).toggleClass("na-active");
      })

      $("#na-search-input").on("keypress", function(e) {
        var key = e.which;
        if(key == 13) {
          var ss = this.value.toLowerCase();
          if(ss != "") {
            var ci = state_bounds.map(function(i) {return i.state}).indexOf(ss);
            if(ci != -1) {
              var bounds = state_bounds[ci];
              
              map.fitBounds([[bounds.south, bounds.west], [bounds.north, bounds.east]]);
              map.setZoom(map.getZoom() + 1);
            
            }
          }
        }
      })

      var myIcon = L.divIcon({className: 'map-icon'});

			function getColor(d) {
			
				return d > 750 ? "#800026":
					   d > 90 ? "#E31A1C":
					   d > 20 ? "#FD8D3C":
									"#FED976";
			}
		
			function style(feature) {
				return {
					fillColor: getColor(feature.properties.POP12_SQMI), 
					weight: 1, 
					color: "#AAA",
					opacity: 1
				}
			}
			function highlightFeature(e) {
				var layer = e.target;

				layer.setStyle({
					weight: 5,
					color: '#888',
					dashArray: '',
				});

				if (!L.Browser.ie && !L.Browser.opera) {
					layer.bringToFront();
				}
			}
			
			function resetHighlight(e) {
				voronoi.resetStyle(e.target);
			}
			
			function onEachFeature(feature, layer) {
				layer.on({
					mouseover: highlightFeature,
					mouseout: resetHighlight
				});
			}
			$(".na-trigger a").on("click", function(e) {
				$("#sidebar").toggleClass("na-open").toggleClass("na-closed");
			})

      $("#na-zoom-out").on("click", function(e) {
        map.fitBounds(us.bounds);
      })

			$(".na-sidebar-group-heading a").on("click", function(e) {
				$(this).parent().siblings(".na-sidebar-group-content").toggleClass("na-sidebar-group-open").toggleClass("na-sidebar-group-closed");
			})
		
			// Define bounds and center of continental us
			var us = {bounds: L.latLngBounds([20, -150], [55, -50]),
					  center: L.latLng([39.8333, -98.5833])
					 }

			function mapResize(el) {
				document.getElementById(el).style.height = (window.innerHeight - 50) + "px"
				document.getElementById(el).style.width = window.innerWidth + "px"
			};

			$(window).resize(function () { 
				mapResize("map")
			});

			mapResize("map");

			var map = L.map('map', {center: us.center, zoom: 5, maxBounds: us.bounds, 
									maxZoom: 12, minZoom: 3, zoomControl: false})

      L.esri.basemapLayer("Gray").addTo(map);
      L.esri.basemapLayer("GrayLabels").addTo(map);
      
			var voronoi;
/**/
      $.ajax({
				dataType: "json",
				url: "data/areatest.geojson",
				success: function(data) {
					voronoi = L.geoJson(data, {
						style: style,
						onEachFeature: onEachFeature
					}).addTo(map);
				}
				}).error(function() {});

      $.ajax({
        dataType: "json",
        url: "data/monitors.geojson",
        success: function(data) {
          monitors = L.geoJson(data, {
            pointToLayer: function(feature, latlon) {return new L.marker(latlon, {icon: myIcon}).addTo(map);},
            onEachFeature: function(feature, layer) {
              layer.bindPopup(feature.properties["o3.MONITOR_ID"]);
            }
          }).addTo(map);          
        }
      })

		</script>
	</body>
</html>